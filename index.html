<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>登録者一覧</title>
</head>
<body>
  <h1>登録者一覧</h1>

  <select id="userSelect">
    <option value="">選択してください</option>
  </select>

  <h2>登録済み設備</h2>
  <ul id="equipmentList"></ul>

  <!-- ここからJS（Supabaseのライブラリを使う） -->
  <script type="module">
    // Supabaseのライブラリをimport
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    // Supabaseの設定
    const supabase = createClient(
      'https://gxgzndqvwrljktiurlai.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd4Z3puZHF2d3Jsamt0aXVybGFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQxNzA5MTAsImV4cCI6MjA1OTc0NjkxMH0.WpeqvO_3sK2iGfQq_4yDC62gJ-eq6wSapi0AVTv5Hnw'
    );

    // 英語 → 日本語の設備名変換
    const equipmentNames = {
      drill_large: 'ボール盤（大）',
      drill_small: 'ボール盤（小）',
      lathe: '旋盤',
      mill_normal: 'たてフライス盤',
      mill_side: '横フライス盤',
      mill_nc: 'NCフライス盤',
      cut_sheet: 'シャー',
      cut_grind: 'カッチング',
      cut_saw: 'カットオフ',
      bend_large: '曲げ機（大）',
      bend_small: '曲げ機（小）',
    };

    // ユーザーリストを取得して表示
    async function loadUsers() {
      const { data: users, error } = await supabase.from('cards').select('*');
      if (error) {
        console.error('データ取得エラー:', error);
        return;
      }

      const userSelect = document.getElementById('userSelect');
      users.forEach(user => {
        const option = document.createElement('option');
        option.value = user.id;
        option.textContent = user.name;
        userSelect.appendChild(option);
      });

      // ユーザーが選択されたら設備を表示
      userSelect.addEventListener('change', function() {
        const selectedId = parseInt(this.value);
        const selectedUser = users.find(user => user.id === selectedId);
        showEquipments(selectedUser);
      });
    }

    // 選択したユーザーの登録設備を表示
    function showEquipments(user) {
      const equipmentList = document.getElementById('equipmentList');
      equipmentList.innerHTML = '';

      if (!user) return;

      Object.keys(equipmentNames).forEach(key => {
        if (user[key] === "1") {  // 1が登録されている設備
          const li = document.createElement('li');
          li.textContent = equipmentNames[key];
          equipmentList.appendChild(li);
        }
      });
    }

    // 初期ロード
    loadUsers();
  </script>
</body>
</html>
